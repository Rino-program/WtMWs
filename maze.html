<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>迷路の最短経路探索（編集・アニメーション付き）</title>
    <style>
        body { font-family: monospace; }
        .maze { margin: 10px 0; }
        .cell {
            width: 24px; height: 24px; display: inline-block;
            text-align: center; vertical-align: middle;
            border: 1px solid #eee; cursor: pointer; user-select: none;
        }
        .wall { background: #222; }
        .empty { background: #fff; }
        .path { background: #4dd; }
        .start { background: #4f4; }
        .goal { background: #f44; }
        .visited { background: #ff0; }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-144HPKP3NS"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-144HPKP3NS');
    </script>
</head>
<body>
    <h1>迷路の最短経路探索（編集・アニメーション付き）</h1>
    <div>
        <label><input type="radio" name="mode" value="wall" checked> 壁を設置</label>
        <label><input type="radio" name="mode" value="empty"> 空白にする</label>
        <label><input type="radio" name="mode" value="start"> スタート</label>
        <label><input type="radio" name="mode" value="goal"> ゴール</label>
        <button onclick="solveMaze()">最短経路を探索する</button>
        <button onclick="resetMaze()">初期化</button>
    </div>
    <div id="maze" class="maze"></div>
    <div id="result"></div>

<script>
const DEFAULT_MAZE = [
    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0],
    [1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0],
    [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
    [0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
    [0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0],
    [0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1],
    [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0],
    [0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0],
    [0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0],
    [0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1],
    [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1],
    [0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1],
    [1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1],
    [1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0],
    [0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    [0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1],
    [0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0],
    [1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1],
    [1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0],
    [1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1],
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0]
];

let maze = [];
let ROWS, COLS;
let start = [0, 0];
let end = [29, 29];

function resetMaze() {
    maze = DEFAULT_MAZE.map(row => row.slice());
    ROWS = maze.length;
    COLS = maze[0].length;
    start = [0, 0];
    end = [29, 29];
    drawMaze();
    document.getElementById('result').innerHTML = '';
}

function drawMaze(solutionPath = [], visitedCells = []) {
    const mazeDiv = document.getElementById('maze');
    mazeDiv.innerHTML = '';
    let pathSet = new Set(solutionPath.map(([x, y]) => `${x},${y}`));
    let visitedSet = new Set(visitedCells.map(([x, y]) => `${x},${y}`));
    for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
            let className = 'cell';
            if (x === start[1] && y === start[0]) className += ' start';
            else if (x === end[1] && y === end[0]) className += ' goal';
            else if (pathSet.has(`${x},${y}`)) className += ' path';
            else if (visitedSet.has(`${x},${y}`)) className += ' visited';
            else if (maze[y][x] === 1) className += ' wall';
            else className += ' empty';
            mazeDiv.innerHTML += `<span class="${className}" data-x="${x}" data-y="${y}" onclick="editCell(${x},${y})">&nbsp;</span>`;
        }
        mazeDiv.innerHTML += "<br>";
    }
}

function editCell(x, y) {
    const mode = document.querySelector('input[name="mode"]:checked').value;
    if (mode === 'wall') {
        if (!(x === start[1] && y === start[0]) && !(x === end[1] && y === end[0])) maze[y][x] = 1;
    } else if (mode === 'empty') {
        if (!(x === start[1] && y === start[0]) && !(x === end[1] && y === end[0])) maze[y][x] = 0;
    } else if (mode === 'start') {
        if (!(x === end[1] && y === end[0])) {
            start = [y, x];
        }
    } else if (mode === 'goal') {
        if (!(x === start[1] && y === start[0])) {
            end = [y, x];
        }
    }
    drawMaze();
}

function solveMaze() {
    const m = maze.map(row => row.slice());
    const sy = start[0], sx = start[1];
    const gy = end[0], gx = end[1];
    const dist = Array.from({ length: ROWS }, () => Array(COLS).fill(-1));
    dist[sy][sx] = 0;
    const queue = [[sx, sy]];
    const visitedCells = [];
    let found = false;

    function animate() {
        if (queue.length === 0) {
            if (!found) {
                document.getElementById('result').innerText = "エラー：スタートとゴールがつながっていません。";
            }
            return;
        }

        const [x, y] = queue.shift();
        visitedCells.push([x, y]);
        drawMaze([], visitedCells);

        if (x === gx && y === gy) {
            found = true;
            const solutionPath = [];
            let cx = gx, cy = gy, d = dist[gy][gx];
            while (d > 0) {
                solutionPath.push([cx, cy]);
                for (let [dx, dy] of [[0, -1], [1, 0], [0, 1], [-1, 0]]) {
                    const nx = cx + dx, ny = cy + dy;
                    if (nx >= 0 && ny >= 0 && nx < COLS && ny < ROWS && dist[ny][nx] === d - 1) {
                        cx = nx;
                        cy = ny;
                        d--;
                        break;
                    }
                }
            }
            solutionPath.push([sx, sy]);
            solutionPath.reverse();
            drawMaze(solutionPath);
            document.getElementById('result').innerText = `最短距離: ${dist[gy][gx]}`;
            return;
        }

        for (let [dx, dy] of [[0, -1], [1, 0], [0, 1], [-1, 0]]) {
            const nx = x + dx, ny = y + dy;
            if (nx >= 0 && ny >= 0 && nx < COLS && ny < ROWS && m[ny][nx] === 0 && dist[ny][nx] === -1) {
                dist[ny][nx] = dist[y][x] + 1;
                queue.push([nx, ny]);
            }
        }

        requestAnimationFrame(animate); // アニメーションの継続
    }

    requestAnimationFrame(animate); // アニメーションの開始
}

window.onload = resetMaze;
</script>
</body>
</html>
