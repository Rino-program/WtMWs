<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>PyodideでPython迷路最短経路</title>
  <style>
    body { font-family: monospace; }
    textarea { width: 100%; height: 200px; }
    pre { background: #eee; padding: 10px; }
  </style>
</head>
<body>
  <h2>Python（Pyodide）で迷路最短経路</h2>
  <textarea id="pycode">
# ここにPythonコードを貼り付けてください
from copy import deepcopy as dc
maze = [
    [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0],
    [0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0],
    [1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0],
    [0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0],
    [0, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0],
    [0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0],
    [0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1],
    [1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0],
    [0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1],
    [0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0],
    [0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0],
    [0, 1, 1, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0],
    [0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0],
    [0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1],
    [1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1],
    [0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1],
    [1, 1, 1, 1, 0, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1],
    [1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1],
    [1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    [0, 1, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0],
    [0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    [0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1],
    [0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0],
    [1, 0, 0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 0, 1, 0, 0, 1],
    [1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
    [0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 1],
    [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
    [1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0]
]
start = (0, 0)
end = (29, 29)

from copy import deepcopy as dc
trueend = ((end[0]+1, end[1]+1))
truestart = ((start[0]+1, start[1]+1))

stack = [(start[0] + 1, start[1] + 1)]
next_stack = []

new_maze = []
new_maze.append(["."]*(len(maze[0])+2))

for i in range(len(maze)):
    new_l = ["."]
    for j in range(len(maze[0])):
        if maze[i][j] == 0:
            new_l.append(0)
        else:
            new_l.append(".")
    new_l.append(".")
    new_maze.append(new_l)
new_maze.append(["."]*(len(maze[0])+2))

new_maze[stack[0][1]][stack[0][0]] = 's'
keep_maze = dc(new_maze)

distance = 1
while trueend not in stack:
    check = False
    for x, y in stack:
        for i in range(4):
            if i == 0: # 上
                if new_maze[y - 1][x] == 0:
                    new_maze[y - 1][x] = distance
                    next_stack.append((x, y - 1))
                    check = True
            if i == 1: # 右
                if new_maze[y][x + 1] == 0:
                    new_maze[y][x + 1] = distance
                    next_stack.append((x + 1, y))
                    check = True
            if i == 2: # 下
                if new_maze[y + 1][x] == 0:
                    new_maze[y + 1][x] = distance
                    next_stack.append((x, y + 1))
                    check = True
            if i == 3: # 左
                if new_maze[y][x - 1] == 0:
                    new_maze[y][x - 1] = distance
                    next_stack.append((x - 1, y))
                    check = True
    if not check:
        print("エラー：スタートとゴールがつながっていない可能性があります。")
        break
    stack = next_stack
    next_stack = []
    distance += 1

print("距離表")
for i in new_maze:
    print(i)
x, y = trueend
distance = new_maze[y][x]
print(f"距離:{distance}")

while distance > 1:
    moved = False
    for i in range(4):
        if i == 0 and y > 0:  # 上
            if new_maze[y - 1][x] == distance - 1:
                y -= 1
                distance -= 1
                keep_maze[y][x] = 2
                break
        if i == 1 and x < len(new_maze[0]) - 1:  # 右
            if new_maze[y][x + 1] == distance - 1:
                x += 1
                distance -= 1
                keep_maze[y][x] = 2
                break
        if i == 2 and y < len(new_maze) - 1:  # 下
            if new_maze[y + 1][x] == distance - 1:
                y += 1
                distance -= 1
                keep_maze[y][x] = 2
                break
        if i == 3 and x > 0:  # 左
            if new_maze[y][x - 1] == distance - 1:
                x -= 1
                distance -= 1
                keep_maze[y][x] = 2
                break

for i in keep_maze:
    for j in range(len(i)):
        if i[j] == ".":
            i[j] = 1
        elif i[j] == "s":
            i[j] = 3

keep_maze[trueend[1]][trueend[0]] = 4

print("迷路の最短経路\n0=空白, 1=壁, 2=最短経路, 3=スタート地点, 4=ゴール地点")
for row in keep_maze:
    print(' '.join(str(cell) for cell in row))
  </textarea>
  <br>
  <button id="runbtn" onclick="runPy()">実行</button>
  <h3>実行結果</h3>
  <pre id="output"></pre>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
  <script>
    let pyodideReady = false;
    let pyodide = null;
    async function loadPyodideAndPackages() {
      pyodide = await loadPyodide();
      pyodideReady = true;
      document.getElementById('runbtn').disabled = false;
    }
    loadPyodideAndPackages();

    async function runPy() {
      if (!pyodideReady) return;
      let code = document.getElementById('pycode').value;
      let output = "";
      try {
        pyodide.setStdout({
          batched: s => output += s + '\n'
        });
        pyodide.setStderr({
          batched: s => output += s + '\n'
        });
        await pyodide.runPythonAsync(code);
      } catch (err) {
        output += err + "\n";
      }
      document.getElementById('output').textContent = output;
    }
  </script>
</body>
</html>
