:root{
  --bg:#0b1220;
  --bg-2:#0f172a;
  --bg-3:#1e293b;
  --text:#e5e7eb;
  --text-muted:#94a3b8;
  --text-light:#cbd5e1;
  --primary:#22c55e;
  --primary-dark:#16a34a;
  --secondary:#334155;
  --secondary-light:#475569;
  --danger:#ef4444;
  --warning:#f59e0b;
  --info:#3b82f6;
  --success:#10b981;
  --card:#111827;
  --card-hover:#1f2937;
  --border:#1f2937;
  --border-light:#374151;
  --shadow:0 4px 6px -1px rgba(0,0,0,0.3);
  --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.4);
  --radius:8px;
  --radius-lg:12px;
}

@media (prefers-color-scheme: light){
  :root[data-theme="light"],
  :root:not([data-theme]){
    --bg:#f8fafc; --bg-2:#ffffff; --bg-3:#f1f5f9; --text:#0f172a; --text-muted:#475569; --text-light:#1e293b;
    --primary:#16a34a; --primary-dark:#15803d; --secondary:#e2e8f0; --secondary-light:#cbd5e1; --danger:#dc2626; --warning:#d97706; --info:#2563eb; --success:#059669;
    --card:#ffffff; --card-hover:#f8fafc; --border:#e5e7eb; --border-light:#d1d5db; --shadow:0 4px 6px -1px rgba(0,0,0,0.1); --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.15);
  }
}

@media (prefers-color-scheme: dark){
  :root[data-theme="dark"]{
    --bg:#0b1220; --bg-2:#0f172a; --bg-3:#1e293b; --text:#e5e7eb; --text-muted:#94a3b8; --text-light:#cbd5e1;
    --primary:#22c55e; --primary-dark:#16a34a; --secondary:#334155; --secondary-light:#475569; --danger:#ef4444; --warning:#f59e0b; --info:#3b82f6; --success:#10b981;
    --card:#111827; --card-hover:#1f2937; --border:#1f2937; --border-light:#374151; --shadow:0 4px 6px -1px rgba(0,0,0,0.3); --shadow-lg:0 10px 15px -3px rgba(0,0,0,0.4);
  }
}

*{box-sizing:border-box}
html,body{height:100%; margin:0; padding:0; scroll-behavior:smooth}
body{
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--text); background:linear-gradient(135deg,var(--bg),var(--bg-2));
  line-height:1.6; font-size:14px;
}

/* Header */
.app-header{
  display:flex; gap:16px; align-items:center; justify-content:space-between; 
  padding:16px 24px; border-bottom:1px solid var(--border); 
  position:sticky; top:0; z-index:100;
  backdrop-filter: blur(12px); background-color: color-mix(in lab, var(--bg-2) 85%, transparent);
  box-shadow:var(--shadow);
}
.app-title{margin:0; font-size:24px; font-weight:700; color:var(--primary)}
.tabs{display:flex; gap:4px;}
.tab-button{
  background:var(--secondary); color:var(--text); border:1px solid var(--border); 
  border-radius:var(--radius); padding:10px 16px; cursor:pointer; font-weight:500;
  transition:all 0.2s ease; position:relative;
}
.tab-button:hover{background:var(--secondary-light); transform:translateY(-1px)}
.tab-button.is-active{background:var(--primary); color:var(--bg); border-color:var(--primary); box-shadow:var(--shadow)}

/* Layout */
main{max-width:1400px; margin:0 auto; padding:24px 16px}

/* Session Layout */
.session-layout{display:grid; grid-template-columns:400px 1fr; gap:24px; min-height:calc(100vh - 200px)}
@media (max-width:1024px){.session-layout{grid-template-columns:1fr; gap:16px}}

/* Panels */
.task-panel, .timer-panel{background:var(--card); border:1px solid var(--border); border-radius:var(--radius-lg); padding:20px; box-shadow:var(--shadow)}
.panel-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:16px}
.panel-header h2{margin:0; font-size:18px; font-weight:600}
.task-actions{display:flex; gap:8px}

/* Buttons */
button{border:none; border-radius:var(--radius); cursor:pointer; font-size:14px; font-weight:500; transition:all 0.2s ease}
.btn-icon{width:40px; height:40px; display:flex; align-items:center; justify-content:center; font-size:16px}
.btn-small{padding:6px 12px; font-size:12px}
.btn-medium{padding:10px 16px}
.btn-large{padding:14px 20px; font-size:16px; display:flex; align-items:center; gap:8px}
.btn-nav{padding:8px; width:36px; height:36px; display:flex; align-items:center; justify-content:center}

button.primary{background:var(--primary); color:var(--bg)}
button.primary:hover{background:var(--primary-dark); transform:translateY(-1px); box-shadow:var(--shadow)}
button.secondary{background:var(--secondary); color:var(--text)}
button.secondary:hover{background:var(--secondary-light)}
button.danger{background:var(--danger); color:white}
button.danger:hover{background:#dc2626; transform:translateY(-1px)}
button:disabled{opacity:.5; cursor:not-allowed; transform:none}

/* Current Task Display */
.current-task-card{background:var(--bg-3); border:1px solid var(--border-light); border-radius:var(--radius); padding:16px; margin-bottom:20px}
.task-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
.current-label{font-size:12px; color:var(--text-muted); font-weight:500}
.current-task .task-title{font-size:16px; font-weight:600; color:var(--text); margin-bottom:4px}
.current-task .task-meta{font-size:12px; color:var(--text-muted); margin-bottom:4px}
.current-task .task-notes{font-size:12px; color:var(--text-light); font-style:italic}

/* Task List */
.task-list h3{margin:0 0 12px 0; font-size:14px; color:var(--text-muted); font-weight:500}
.task-items{display:flex; flex-direction:column; gap:8px}
.task-item{
  background:var(--card-hover); border:1px solid var(--border); border-radius:var(--radius); 
  padding:12px; cursor:pointer; transition:all 0.2s ease; position:relative;
}
.task-item:hover{background:var(--bg-3); border-color:var(--border-light)}
.task-item.active{border-color:var(--primary); background:color-mix(in lab, var(--primary) 10%, transparent)}
.task-item .task-name{font-weight:500; margin-bottom:4px}
.task-item .task-subject{font-size:12px; color:var(--text-muted)}
.task-item .task-progress{margin-top:8px}

/* Progress Bars */
.progress-bar-container{background:var(--bg-3); border-radius:4px; height:6px; overflow:hidden; margin-top:4px}
.progress-bar-fill{background:var(--primary); height:100%; border-radius:4px; transition:width 0.3s ease}
.progress-text{font-size:11px; color:var(--text-muted); margin-top:2px}

/* Timer */
.timer-container{text-align:center}
.session-info{margin-bottom:32px}
.timer-mode{font-size:18px; color:var(--text-muted); margin-bottom:20px}
.separator{margin:0 8px}

/* Progress Ring */
.progress-ring{position:relative; display:inline-block; margin-bottom:24px}
.progress-svg{transform:rotate(-90deg)}
.progress-bg{fill:none; stroke:var(--border); stroke-width:8}
.progress-bar{fill:none; stroke:var(--primary); stroke-width:8; stroke-linecap:round; 
  stroke-dasharray:565.48; stroke-dashoffset:565.48; transition:stroke-dashoffset 0.3s ease}
.timer-display{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center}
.time{font-size:48px; font-weight:700; letter-spacing:-1px; line-height:1}
.time-percent{font-size:14px; color:var(--text-muted); margin-top:4px}

/* Controls */
.controls{display:flex; flex-wrap:wrap; gap:12px; justify-content:center; margin-bottom:24px}

/* Session Stats */
.session-stats{display:flex; justify-content:space-around; margin-bottom:20px; padding:16px; background:var(--bg-3); border-radius:var(--radius)}
.stat-item{text-align:center}
.stat-label{display:block; font-size:12px; color:var(--text-muted); margin-bottom:4px}
.stat-value{font-size:16px; font-weight:600; color:var(--primary)}

/* Forms */
.task-form{background:var(--bg-3); border:1px solid var(--border); border-radius:var(--radius); padding:16px; margin-top:16px}
.task-form h3{margin:0 0 16px 0; font-size:16px}
.task-form input{width:100%; margin-bottom:12px; padding:10px; background:var(--card); color:var(--text); border:1px solid var(--border); border-radius:var(--radius)}
.task-form input:focus{outline:none; border-color:var(--primary)}
.goal-setting{margin:12px 0}
.goal-setting label{display:block; margin-bottom:4px; font-size:12px; color:var(--text-muted)}
.form-actions{display:flex; gap:8px; margin-top:16px}

/* Shortcuts hint */
.shortcuts-hint{margin-top:16px}
.shortcuts-hint kbd{background:var(--secondary); padding:2px 6px; border-radius:4px; font-size:11px}

/* Dashboard Layout */
.dashboard-layout{display:flex; flex-direction:column; gap:24px}
.stats-overview{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:24px}
.stat-card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:20px; display:flex; align-items:center; gap:16px; box-shadow:var(--shadow)}
.stat-icon{font-size:32px}
.stat-content .stat-value{font-size:28px; font-weight:700; line-height:1}
.stat-content .stat-label{font-size:12px; color:var(--text-muted); margin-top:4px}

/* Period Stats */
.period-stats{display:grid; grid-template-columns:1fr 1fr; gap:24px}
@media (max-width:768px){.period-stats{grid-template-columns:1fr}}

/* Cards */
.card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius-lg); padding:20px; box-shadow:var(--shadow)}
.card-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:16px}
.card-header h2{margin:0; font-size:18px; font-weight:600}
.period-nav{display:flex; align-items:center; gap:8px}
.current-period{font-size:14px; color:var(--text-muted); min-width:60px; text-align:center}

/* Summary */
.today-summary, .week-summary{display:flex; gap:24px; margin-bottom:20px; flex-wrap:wrap}
.summary-item{text-align:center}
.summary-label{display:block; font-size:12px; color:var(--text-muted); margin-bottom:4px}
.summary-value{font-size:18px; font-weight:600}

/* Progress Lists */
.task-progress-list{display:flex; flex-direction:column; gap:12px; margin-bottom:20px}
.task-progress-item{background:var(--bg-3); border-radius:var(--radius); padding:12px}
.task-progress-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:8px}
.task-name{font-weight:500}
.task-time{font-size:12px; color:var(--text-muted)}

/* Session History */
.session-history{max-height:200px; overflow-y:auto}
.session-item{display:flex; justify-content:space-between; align-items:center; padding:8px 0; border-bottom:1px solid var(--border)}
.session-item:last-child{border-bottom:none}
.session-time{font-size:12px; color:var(--text-muted)}

/* Week Chart */
.week-chart{margin-bottom:20px}
.chart-bars{display:flex; align-items:end; gap:8px; height:100px; margin-bottom:8px}
.chart-bar{background:var(--primary); border-radius:2px; min-height:2px; flex:1; transition:height 0.3s ease}
.chart-labels{display:flex; justify-content:space-between}
.chart-labels span{font-size:10px; color:var(--text-muted)}

/* Task Breakdown */
.task-breakdown{display:flex; flex-direction:column; gap:8px}
.breakdown-item{display:flex; justify-content:space-between; align-items:center; padding:8px; background:var(--bg-3); border-radius:var(--radius)}
.breakdown-bar{height:4px; background:var(--bg-2); border-radius:2px; overflow:hidden; margin:4px 0}
.breakdown-fill{height:100%; background:var(--primary); border-radius:2px}

/* Settings Layout */
.settings-layout{display:flex; flex-direction:column; gap:20px; max-width:800px}
.settings-grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:16px; margin-bottom:16px}
.setting-item{display:flex; flex-direction:column; gap:4px}
.setting-item label{font-size:12px; color:var(--text-muted); font-weight:500}
.setting-item input, .setting-item select{padding:8px; background:var(--bg-3); color:var(--text); border:1px solid var(--border); border-radius:var(--radius)}
.setting-item input:focus, .setting-item select:focus{outline:none; border-color:var(--primary)}

/* Checkbox */
.setting-item label input[type="checkbox"]{width:auto; margin-right:8px}
.checkbox-label{display:flex; align-items:center; cursor:pointer}

/* Setting Actions */
.setting-actions, .data-actions{display:flex; gap:12px; flex-wrap:wrap}
.goal-settings, .notification-settings, .appearance-settings{margin-bottom:16px}

/* Data Info */
.data-info{display:flex; gap:20px; margin:16px 0; flex-wrap:wrap}
.info-item{text-align:center}
.info-label{display:block; font-size:12px; color:var(--text-muted); margin-bottom:4px}
.info-value{font-size:16px; font-weight:600}

/* App Info */
.app-info{color:var(--text-muted); line-height:1.6}
.app-info p{margin:8px 0}

/* File Label */
.file-label{cursor:pointer}
.file-label input{display:none}
.file-label span{display:inline-block; padding:10px 16px; background:var(--secondary); color:var(--text); border-radius:var(--radius); transition:all 0.2s ease}
.file-label:hover span{background:var(--secondary-light)}

/* Utilities */
.hidden{display:none !important}
.sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0}
.hint{color:var(--text-muted); font-size:12px; margin:8px 0}
.text-center{text-align:center}
.mt-2{margin-top:8px}
.mb-2{margin-bottom:8px}

/* Tab Panes */
.tab-pane{display:none}
.tab-pane.is-active{display:block}

/* Footer */
.app-footer{padding:20px; text-align:center; color:var(--text-muted); border-top:1px solid var(--border); margin-top:40px}

/* Responsive */
@media (max-width:768px){
  .app-header{padding:12px 16px}
  .app-title{font-size:20px}
  .tabs{flex-wrap:wrap}
  main{padding:16px 12px}
  .session-layout{gap:16px}
  .task-panel, .timer-panel{padding:16px}
  .time{font-size:36px}
  .controls{gap:8px}
  .btn-large{padding:12px 16px; font-size:14px}
  .stats-overview{grid-template-columns:1fr 1fr}
  .stat-card{padding:16px}
  .stat-icon{font-size:24px}
  .stat-content .stat-value{font-size:20px}
  .today-summary, .week-summary{gap:16px}
  .data-info{gap:16px}
}

@media (max-width:480px){
  .session-layout{grid-template-columns:1fr}
  .stats-overview{grid-template-columns:1fr}
  .period-stats{grid-template-columns:1fr}
  .settings-grid{grid-template-columns:1fr}
  .today-summary, .week-summary{flex-direction:column; gap:12px}
  .data-actions{flex-direction:column}
  .setting-actions{flex-direction:column}
}
